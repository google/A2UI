{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "A2UI Message Schema",
  "description": "Describes a JSON payload for an A2UI (Agent to UI) message, which is used to dynamically construct and update user interfaces. A message MUST contain exactly ONE of the action properties: 'beginRendering', 'surfaceUpdate', 'dataModelUpdate', or 'deleteSurface'.",
  "type": "object",
  "properties": {
    "beginRendering": {
      "type": "object",
      "description": "Signals the client to begin rendering a surface with a root component and specific styles. When this message is received, the client should expect a 'surfaceUpdate' message for the same 'surfaceId' that contains the component tree. One of the components in that tree MUST have the 'id' of 'root'.",
      "properties": {
        "surfaceId": {
          "type": "string",
          "description": "The unique identifier for the UI surface to be rendered."
        },
        "root": {
          "type": "string",
          "description": "The ID of the root component to render."
        },
        "styles": {
          "type": "object",
          "description": "Styling information for the UI.",
          "properties": {
            "font": {
              "type": "string",
              "description": "The primary font for the UI."
            },
            "primaryColor": {
              "type": "string",
              "description": "The primary UI color as a hexadecimal code (e.g., '#00BFFF').",
              "pattern": "^#[0-9a-fA-F]{6}$"
            }
          }
        }
      },
      "required": ["surfaceId"]
    },
    "surfaceUpdate": {
      "type": "object",
      "description": "Updates a surface with a new set of components.",
      "properties": {
        "surfaceId": {
          "type": "string",
          "description": "The unique identifier for the UI surface to be updated. If you are adding a new surface this *must* be a new, unique identified that has never been used for any existing surfaces shown."
        },
        "components": {
          "type": "array",
          "description": "A list containing all UI components for the surface.",
          "minItems": 1,
          "items": {
            "$ref": "component_catalog.json#/$defs/anyComponent"
          }
        }
      },
      "required": ["surfaceId", "components"]
    },
    "dataModelUpdate": {
      "type": "object",
      "description": "Updates the data model for a surface.",
      "properties": {
        "surfaceId": {
          "type": "string",
          "description": "The unique identifier for the UI surface this data model update applies to."
        },
        "path": {
          "type": "string",
          "description": "An optional path to a location within the data model (e.g., '/user/name'). If omitted, or set to '/', the entire data model will be replaced."
        },
        "contents": {
          "type": "object",
          "description": "The data to be updated in the data model. This can be any valid JSON object.",
          "additionalProperties": true
        }
      },
      "required": ["contents", "surfaceId"]
    },
    "deleteSurface": {
      "type": "object",
      "description": "Signals the client to delete the surface identified by 'surfaceId'.",
      "properties": {
        "surfaceId": {
          "type": "string",
          "description": "The unique identifier for the UI surface to be deleted."
        }
      },
      "required": ["surfaceId"]
    }
  },
  "$defs": {
    "stringOrPath": {
      "type": "object",
      "description": "Represents a value that can be either a literal string or a path to a value in the data model.",
      "properties": {
        "literalString": {
          "type": "string"
        },
        "path": {
          "type": "string"
        }
      },
      "oneOf": [{ "required": ["literalString"] }, { "required": ["path"] }]
    },
    "numberOrPath": {
      "type": "object",
      "description": "Represents a value that can be either a literal number or a path to a value in the data model.",
      "properties": {
        "literalNumber": {
          "type": "number"
        },
        "path": {
          "type": "string"
        }
      },
      "oneOf": [{ "required": ["literalNumber"] }, { "required": ["path"] }]
    },
    "booleanOrPath": {
      "type": "object",
      "description": "Represents a value that can be either a literal boolean or a path to a value in the data model.",
      "properties": {
        "literalBoolean": {
          "type": "boolean"
        },
        "path": {
          "type": "string"
        }
      },
      "oneOf": [{ "required": ["literalBoolean"] }, { "required": ["path"] }]
    },
    "stringArrayOrPath": {
      "type": "object",
      "description": "Represents a value that can be either a literal array of strings or a path to a value in the data model.",
      "properties": {
        "literalArray": {
          "type": "array",
          "items": { "type": "string" }
        },
        "path": {
          "type": "string"
        }
      },
      "oneOf": [{ "required": ["literalArray"] }, { "required": ["path"] }]
    },
    "componentProperties": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "The unique identifier for this component."
        },
        "weight": {
          "type": "number",
          "description": "The relative weight of this component within a Row or Column. This corresponds to the CSS 'flex-grow' property. Note: this may ONLY be set when the component is a direct descendant of a Row or Column."
        }
      },
      "required": ["id"]
    },
    "childrenProperty": {
      "type": "object",
      "description": "Defines the children. Use 'explicitList' for a fixed set of children, or 'template' to generate children from a data list.",
      "properties": {
        "explicitList": {
          "type": "array",
          "items": { "type": "string" }
        },
        "template": {
          "type": "object",
          "description": "A template for generating a dynamic list of children from a data model list. `componentId` is the component to use as a template, and `dataBinding` is the path to the map of components in the data model. Values in the map will define the list of children.",
          "properties": {
            "componentId": { "type": "string" },
            "dataBinding": { "type": "string" }
          },
          "required": ["componentId", "dataBinding"]
        }
      },
      "oneOf": [{ "required": ["explicitList"] }, { "required": ["template"] }]
    }
  }
}
